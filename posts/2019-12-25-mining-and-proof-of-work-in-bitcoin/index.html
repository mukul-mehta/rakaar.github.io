<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Mining and Proof of Work in Bitcoin - Raghavendra Kaushik</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction Pre-requisite: Basic understanding of Blockchain. More specifically, I will be talking about Bitcoin&rsquo;s mining. But it also applies to other cryptocurrencies following the same consensus protocol(we will see what that exactly means). My aim, while writing this is to provide some intuition behind proof of work algorithm and to explain in detail behind the puzzle that is solved by the miners in order to add a valid block to the Blockchain."><meta property="og:image" content><meta property="og:title" content="Mining and Proof of Work in Bitcoin"><meta property="og:description" content="Introduction Pre-requisite: Basic understanding of Blockchain. More specifically, I will be talking about Bitcoin&rsquo;s mining. But it also applies to other cryptocurrencies following the same consensus protocol(we will see what that exactly means). My aim, while writing this is to provide some intuition behind proof of work algorithm and to explain in detail behind the puzzle that is solved by the miners in order to add a valid block to the Blockchain."><meta property="og:type" content="article"><meta property="og:url" content="https://rakaar.github.io/posts/2019-12-25-mining-and-proof-of-work-in-bitcoin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-25T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mining and Proof of Work in Bitcoin"><meta name=twitter:description content="Introduction Pre-requisite: Basic understanding of Blockchain. More specifically, I will be talking about Bitcoin&rsquo;s mining. But it also applies to other cryptocurrencies following the same consensus protocol(we will see what that exactly means). My aim, while writing this is to provide some intuition behind proof of work algorithm and to explain in detail behind the puzzle that is solved by the miners in order to add a valid block to the Blockchain."><script src=https://rakaar.github.io/js/feather.min.js></script><link href=https://rakaar.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://rakaar.github.io/css/main.5a5ffad9e55591a3e4fcebdb9ed3807c781cabfdb4de3dcf89a187a9f18d9bd9.css></head><body><div class=content><header><div class=main><a href=https://rakaar.github.io/>Raghavendra Kaushik</a></div><nav><a href=/>Home</a>
<a href=/posts>Blog</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
<a href=/credits>Credits</a></nav></header><main><article><div class=title><h1 class=title>Mining and Proof of Work in Bitcoin</h1><div class=meta>Posted on Dec 25, 2019</div></div><section class=body><h1 id=introduction>Introduction</h1><p>Pre-requisite: Basic understanding of Blockchain.
More specifically, I will be talking about Bitcoin&rsquo;s mining. But it also applies to other cryptocurrencies following the same consensus protocol(we will see what that exactly means). My aim, while writing this is to provide some intuition behind proof of work algorithm and to explain in detail behind the puzzle that is solved by the miners in order to add a valid block to the Blockchain. I will be focussing on the parts which are not very abundant on the internet or are compromised with a high-level overview of things.</p><h1 id=intuition-behind-consensus-protocols-and-proof-of-work>Intuition behind consensus protocols and Proof of work</h1><p>Bitcoin or in fact any other cryptocurrency is decentralized. That means there is <strong>NO</strong> central authority to provide services, maintain records, etc. That is the main aim of introducing Bitcoin - Having no central Master. In our daily life, it is the banks that send money on our behalf, keep a track of how much money each individual is left with. Now in case of a decentralized system, how do you achieve that?
The set of rules by which a decentralized system comes to an agreement that &lsquo;Yes! this is the state of the system.&rsquo;. For example in Bitcoin, everyone needs to come to the conclusion that a particular transaction is valid and can be appended to the Blockchain.
Now for Bitcoin, let&rsquo;s think of a naive Consensus protocol, where each member in the network provides one vote. Seems fair? No!
Well in Bitcoin, to become a part of a network all you need is a device and internet connection. A malicious individual(say Mr.X) can easily take advantage of this. X can now create multiple identities with ease. He will create a fake transaction and broadcast it to the network. Since many of the nodes in the network are controlled by X, they will receive the majority votes and hence will be validated. Likewise, there might be many people like X in the network. The whole system is flawed :(
So what can be done? The basic step towards solving this problem is to make the process of voting a bit difficult. Or to rephrase it- Make a vote costlier. That means, for an individual in the network to vote whether the transaction is valid or not he or she also has to spend some resources. Resources that are valuable, available with everyone so that everyone has an equal opportunity to participate. Satoshi Nakamoto(inventor of Bitcoin) chose &ldquo;Computing Power&rdquo;. In order to validate a transaction, you need to spend some amount of computing power. You need to provide proof that you have spent your resources to validate the transactions and add them to the blockchain. This proof is provided by solving a cryptographic hash puzzle(we will see in detail about it) which is computationally difficult to solve since the only way to get the right answer is by trial and error. This consensus Protocol is named as <em>Proof of Work</em>.
In simpler words, Proof of work is a method by which you translate your computing power to voting power. That is also why, in bitcoin white paper you can see the words <code>1 CPU 1 Vote</code>, rather than <code>1 Identity 1 Vote</code>, which is a general case.
What is the Cryptographic Hash puzzle? How is it solved? To understand that, we need to know about the anatomy of a Block in Bitcoin Blockchain.</p><h1 id=anatomy-of-a-block>Anatomy of a block</h1><p>A block in a blockchain consists of these following things(* means will explain soon)</p><ul><li>Block header: Consists of Metadata of the block, which enforces the security of the blockchain<ul><li>Previous block hash: Evident from the name, Hash of the Previous Block</li><li>Merkle Root*</li><li>Nonce *</li><li>Timestamp: Evident from the name, time at which the block was created.</li><li>Version: Version of the Bitcoin software used by the miner</li><li>Block hash*</li><li>Bits*</li></ul></li><li>Blocksize: Size of the block</li><li>Transaction Counter: Number of transactions in a block</li><li>Transactions: The actual list of transactions</li></ul><h1 id=merkle-root>Merkle Root:</h1><p>It is the hash of the transactions in a tree fashion. In simpler words, Merkle root is the summary hash of all the transactions of a given block. Check the below image for clarity.
<img src=/img/mining-merkle-root.jpg alt="Merkle Root">
Why do you have to do that? Why not just hash all of them Linearly at once?
The main reason behind this is that it will be computationally cheaper to verify whether a single transaction is present or not in this case.<br>Suppose there are 8 transactions, as per the below image and we hash all of them linearly to obtain the summary, to verify any transaction we need all the other 7 transactions, Check the image below
<img src=/img/mining-merkle-7.jpg alt="Non Merkle Root 7 are required">
In case of a tree, you need just three hashes that are marked in blue to verify whether that particular transaction exists or not
<img src=/img/mining-merkle-3.jpg alt="Merkle only 3 are required">
BlockHash:
Block hash is obtained by hashing these three things - Previous Blockhash, Merkle root, and Nonce.
Nonce:
A nonce is a number that is hashed with Previous block hash and Merkle root to find a valid block hash. When do you consider a block hash valid? A block hash is considered valid when it is less than a specific number called <code>target</code> which is embedded in Bits of the block.
Bits:
As mentioned previously, it is a compact notation of the target. For example, taken from <a href=http://blog.geveo.com/Blockchain-Mining-Difficulty>this</a> article
Bits of a certain block is 402809567 in decimal when converted to hex: 18 02 62 DF.
Now the first byte indicates the length of the hash target. So in this case, 24 (18 in hex) would be the length of the hash target. And the next 3 bytes are the most significant digits of the hash target. Hence the hash target would be
as per this image</p><h1 id=the-cryptographic-hash-puzzle>The cryptographic Hash puzzle</h1><p>Now let us understand the puzzle that is solved to add a block to the blockchain. It is here that you get a clear understanding of the terms - Nonce, and Bits.
A miner&rsquo;s job is to find a number that when hashed with the Previous Block hash and Merkle root gives the hash which is less than the hash target of the block.
In simpler words
hash(prevBlockhash, MerkleRoot, Num) &lt; HashTarget
Our aim is to find the Num
The starting value of Num is 0, they hash it and check if the hash is less than HashTarget or not. If not increment it and hash it again and check again if it is less than the hash target or not. And the process is continued until a valid block hash is found, that means finally the resulting hash is less than the HashTarget.
The Num is called Nonce because it is used only once to check, if it doesn&rsquo;t meet our requirements, then we increment and continue checking. But we are not going to use the same number again with a particular pair of Previous Blockhash and Merkle Root.
By solving the cryptographic hash puzzle to validate transactions means to find a number when hashed with previous block hash and the summary hash of transactions(Merkle root) results in a number less than the hash target. This is what it all boils down to!
How tough is this?
Just for sake of analogy, imagine if you are blindfolded and you are asked to hit only a specific region of the dartboard. How can you achieve it? The only way is by throwing more darts on the board hoping that they would hit the specific region. Similarly here, the only way is to increase the probability of success is by checking with more numbers(Nonces).
Now you can see that it takes a decently large amount of computing power to add a block to the blockchain, hence validate the list of transactions. Hence, the miner who has solved the puzzle has a &lsquo;proof of work&rsquo; done by finding the valid block hash, which we have seen how computationally expensive is this.</p><h3 id=what-is-the-maximum-value-of-the-nonce-does-it-keeping-going-on-and-on-and-on>What is the maximum value of the nonce? Does it keeping going on and on and on&mldr;..?</h3><p>No! The nonce is a 32-byte value. So its maximum value is 2^32 - 1. What if no value of nonce satisfies the given condition. That is no number less than equal to 2^32-1 when hashed with the previous block hash and Merkle root of the block results in hash less than the hash target?
Do we change the hash target?
No!
Do we change the previous block hash?
Obviously No! How can one do that?
The left thing is Merkle Root. How do you change that?
We have missed one fact! Let us see that here:</p><h1 id=coinbase-nonce>Coinbase Nonce</h1><p>When a miner adds a valid block to the blockchain, he receives a fixed reward. Even that is considered as one of the transactions in the block, that has a special name called &lsquo;Coinbase Transaction&rsquo;. At the lowest level in the Merkle tree, the coin base transaction is the first transaction. There is something called &lsquo;Coinbase Nonce&rsquo;, which is just arbitrary data that is hashed in the process of creating a Merkle root. Now to change the Merkle root, since we can&rsquo;t change the rest of the transactions. It is this Coinbase Nonce that can be changed and hence changing the Merkle Root.
Now you can start the nonce value fresh from 0 again and check by hashing with the previous Blockhash and this new Merkle Root verify. Increment the nonce and repeat the process. If that fails too, try again with a different Coinbase nonce, hence a different Merkle Root</p><h1 id=reward-for-miners>Reward for miners</h1><p>There is a reward for miners for every valid block they add to the blockchain. Generally, this reward is decreased by 1/2 for every 210,000 blocks. The initial block rewards from the beginning were 50 BTC. The current Blockreward is 12.5 BTC. 210,000 blocks are approximately mined for a period of 4 years. (You will see soon how these are approximated). There is one more interesting thing to note. Mining is the only process through which Bitcoins can be generated. So, one can conclude that the maximum number of Bitcoins that can exist are:</p><p><code>210,000(50 + 25 + 12.5 + 6.25 + ....) = 21,000,000 BTC</code></p><p>21 Million is the maximum number of bitcoin that can be created.</p><h1 id=is-the-hash-target-fixed>Is the Hash target fixed?</h1><p>No dear! There are times where there are more miners in the network, and times when there are very few in the network. The main goal of Satoshi Nakamoto was to keep the block time fixed as approximately 10 minutes. That is for every 10 minutes, a block is added to the blockchain.
The way to keep this time constant is to adjust the Hash target. Suppose there are many miners in the network, and the blocks are getting mined soon. We need to increase the difficulty of the puzzle - that implies we need to reduce the Hash target. Why? Because there are fewer choices. For example, if the hash target was 0FFFF (65,535), which means the miner needs to find a nonce which when hashed with previous Block hash and Merkle Root gives a number less than 65,535. We have 65,536 choices(0 to 65,535). Too many! Now if the hash target was 000FF(255), we have only 256 choices.
And if there are less number of miners, it means the blocks are mined slowly, hence we need to make the puzzle easier, Hence increase the Hash target. In analogy with the Darts game, think of it as adjust the radius of the region where you want the dart to get hit.
And this is changed on observing the average block time of the last 2016 blocks(approximately every 2 weeks, why?
2016 x 10 mins = 20160 mins = 14 days = 2 Weeks).
To quantify the above words:
<img src=/img/mining-hash-target.png alt="Hash Target">
<em>Image Credits from <a href=http://blog.geveo.com/Blockchain-Mining-Difficulty>this blog</a></em></p><h1 id=final-words>Final words</h1><p>Currently, Most of the mining in bitcoin is not done individually. People who mine come together and form Mining pools. Here, under the guidance of a pool manager, profits are distributed accordingly as per various pool schemes.
This is just one of the many interesting aspects of Bitcoin. Finally, I would like to conclude with this beautiful tweet!
<img src=/img/mining-final-tweet.png alt=Tweet></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/bitcoin>bitcoin</a></li><li><a href=/tags/mining>mining</a></li><li><a href=/tags/pow>PoW</a></li><li><a href=/tags/consensus_protochol>consensus_protochol</a></li><li><a href=/tags/blockchain>blockchain</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://rakaar.github.io/index.xml title=RSS><i data-feather=rss></i></a>|<a class=soc href=mailto:rka87338@gmail.com title=Email><i data-feather=mail></i></a>|<a class=soc href=https://github.com/rakaar title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/raghavendrakau9 title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>