<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>- Raghavendra Kaushik</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="date: &ldquo;2021-07-03T00:00:00Z&rdquo; description: Running Github Actions on Self hosted Cloud machines tags:
 deployment programming title: Setting up Cirun on Digital Ocean   The problem Github Actions are amazing. They let you perform jobs on Github Cloud. But if you are using Github Actions too much, you might run out of the free minutes and you end up paying a lot. It is very likely that you are already paying for a cloud provider like AWS, Digital Ocean or Azure."><meta property="og:image" content><meta property="og:title" content><meta property="og:description" content="date: &ldquo;2021-07-03T00:00:00Z&rdquo; description: Running Github Actions on Self hosted Cloud machines tags:
 deployment programming title: Setting up Cirun on Digital Ocean   The problem Github Actions are amazing. They let you perform jobs on Github Cloud. But if you are using Github Actions too much, you might run out of the free minutes and you end up paying a lot. It is very likely that you are already paying for a cloud provider like AWS, Digital Ocean or Azure."><meta property="og:type" content="article"><meta property="og:url" content="https://rakaar.github.io/posts/2021-07-03-cirun/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="date: &ldquo;2021-07-03T00:00:00Z&rdquo; description: Running Github Actions on Self hosted Cloud machines tags:
 deployment programming title: Setting up Cirun on Digital Ocean   The problem Github Actions are amazing. They let you perform jobs on Github Cloud. But if you are using Github Actions too much, you might run out of the free minutes and you end up paying a lot. It is very likely that you are already paying for a cloud provider like AWS, Digital Ocean or Azure."><script src=https://rakaar.github.io/js/feather.min.js></script><link href=https://rakaar.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://rakaar.github.io/css/main.5a5ffad9e55591a3e4fcebdb9ed3807c781cabfdb4de3dcf89a187a9f18d9bd9.css></head><body><div class=content><header><div class=main><a href=https://rakaar.github.io/>Raghavendra Kaushik</a></div><nav><a href=/>Home</a>
<a href=/posts>Blog</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
<a href=/credits>Credits</a></nav></header><main><article><div class=title><h1 class=title></h1><div class=meta>Posted on Jan 1, 0001</div></div><section class=body><p>date: &ldquo;2021-07-03T00:00:00Z&rdquo;
description: Running Github Actions on Self hosted Cloud machines
tags:</p><ul><li>deployment</li><li>programming
title: Setting up Cirun on Digital Ocean</li></ul><hr><h2 id=the-problem>The problem</h2><p>Github Actions are amazing. They let you perform jobs on Github Cloud. But if you are using Github Actions too much, you might run out of the free minutes and you end up paying a lot. It is very likely that you are already paying for a cloud provider like AWS, Digital Ocean or Azure. So, a better idea would be to run the job on the existing cloud itself, instead of paying separately to run on Github cloud.</p><p>The best part about Github Actions is they allow you to run these jobs on Self hosted machines. That means when an event happens, Github will send a request to API that you provide to let you know that job needs to be performed. And you can perform the job on your own cloud machine. By using this process, you have 2 advantages</p><ul><li>You don&rsquo;t have to pay for Github Actions</li><li>You can see checks and logs on Github&rsquo;s interface</li></ul><h2 id=cirunio>Cirun.io</h2><p>Setting up your self hosted runner with Github Actions from scratch is a time taking process. Cirun.io saves your time. Setting up Cirun.io is extremely easy. The rest of blog shows you how to setup self-hosted runner on Digital Ocean using Cirun. The following steps outline process is</p><ol><li><p>Sign up on Cirun using Github</p></li><li><p>Connect Digital Ocean with Cirun.io</p></li><li><p>Install Cirun on the Repo</p></li><li><p>Add Github Actions file</p></li><li><p>Add a <code>.cirun.yml</code> file</p></li><li><p>Toggle on the Actions on Cirun</p><p>Its done!</p></li></ol><p>The first step is a trivial step, just like any other OAuth signup.</p><h2 id=connect-digital-ocean-with-cirun>Connect Digital Ocean with Cirun</h2><ol><li>In the navbar present on the left hand side, click on <code>Cloud</code> and click on the <code>Connect DigitialOcean</code> button</li></ol><p><img src=https://imgur.com/XmPyPzN.png alt="Click on Cloud"></p><ol start=2><li>Give access to the account that you want to</li></ol><p><img src=https://imgur.com/OKQYUtz.png alt="Give Access to Cirun"></p><h2 id=install-cirun-on-the-repo>Install Cirun on the repo</h2><ol><li><p>In the Navbar present on the left hand side, click on <code>Repositories</code> and click on <code>Install App on Github</code></p><p><img src=https://imgur.com/5vdrJGP.png alt="Installing App on Repo"></p></li><li><p>Select the organization or your account(like I did)</p><p><img src=https://imgur.com/tSgeNdM.png alt="Select Organization"></p></li><li><p>Select the repo on which you want to install</p><p><img src=https://imgur.com/rhfeTsI.png alt="Select repo"></p></li><li><p>Click install</p><p><img src=https://imgur.com/Z1HWV22.png alt=Install></p><h2 id=adding-github-actions-file>Adding Github Actions file</h2><p>To add the <code>yaml</code> file for Github Actions, create a new file, say <code>demo.yml</code> at the path <code>.github/workflows/demo.yml</code>. Here is a simple action, which does a simple <code>wget</code> request when something is pushed to the repo.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Sample demo Action</span>

<span style=color:#f92672>on</span>:
  <span style=color:#ae81ff>push</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>build</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Send a GET request via wget</span>
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>self-hosted</span> <span style=color:#75715e># THIS IS IMPORTANT</span>
    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>wget request</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>wget https://archive.org/stream/GuerillaOpenAccessManifesto/Goamjuly2008_djvu.txt</span>

</code></pre></td></tr></table></div></div></li></ol><p><strong>Note that <code>runs-on</code> has the value <code>self-hosted</code>. The name of machine should not be mentioned in this file.</strong></p><h2 id=adding-cirunyml-file>Adding .cirun.yml file</h2><p>In the root of the repository file, create a file named <code>.cirun.yml</code> which will be utilized by Cirun to run action on the machine.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># Self-Hosted Github Action Runners on DO via Cirun.io</span>
<span style=color:#75715e># Reference: https://docs.cirun.io/reference/yaml.html</span>
<span style=color:#f92672>runners</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Sample action</span>
    <span style=color:#75715e># Cloud Provider: DigitalOcean</span>
    <span style=color:#f92672>cloud</span>: <span style=color:#ae81ff>digitalocean</span>
    <span style=color:#75715e># Cheapest VM on DigitalOcean</span>
    <span style=color:#f92672>instance_type</span>: <span style=color:#ae81ff>s-1vcpu-1gb</span>
    <span style=color:#75715e># Ubuntu-20.4  image&#34;</span>
    <span style=color:#f92672>machine_image</span>: <span style=color:#ae81ff>ubuntu-20-10-x64</span>
    <span style=color:#75715e># Path of the relevant workflow file</span>
    <span style=color:#f92672>workflow</span>: <span style=color:#ae81ff>.github/workflows/demo.yml</span>
    <span style=color:#75715e># Number of runners to provision on every trigger on Actions job</span>
    <span style=color:#f92672>count</span>: <span style=color:#ae81ff>1</span>

</code></pre></td></tr></table></div></div><p>The comments in the above code are self-explanatory.</p><h2 id=toggle-on>Toggle on</h2><p>In Cirun Dashboard, click on <code>Repositories</code> present on the navbar on left hand side. Toggle on the repo, where you have installed Github Actions</p><p><img src=https://imgur.com/iMxRkod.png alt="Toggle on"></p><h2 id=testing>Testing</h2><p>To test lets trigger a commit in README</p><p><img src=https://imgur.com/y6dKW08.png alt="Trigger a commit"></p><p>Its running!</p><p><img src=https://imgur.com/y0jH9mZ.png alt="Its running"></p><p>And its done!</p><p><img src=https://imgur.com/L7kSxSa.png alt=Done></p><h1 id=note>Note</h1><ol><li><p>You can see in the above image that some of the previous actions failed. That is because it takes some time for Cirun to start working. So if it fails, check the configuration files once again and if everything seems alright, try triggering another commit after few minutes.</p></li><li><p>If its a cronjob, it takes some time to get triggered. If you want to verify if your configurations file are configured right, follow these steps</p><ul><li><p>Make changes to file present in <code>.github/workflows</code> such that action is triggered on a push</p></li><li><p>Try making a commit after few minutes. If it still fails, try reading the error logs under Actions tab in Github(a common error is not putting <code>self-hosted</code> in the Github Actions file as discussed above)</p></li></ul></li></ol><h2 id=turning-off>Turning off</h2><ol><li><p>Vist the Cirun Dashboard</p></li><li><p>Click on the <code>Repositories</code> on the navbar present on the left hand side</p></li><li><p>Click the toggle button beside the repository name you want to turn off</p><p><img src=https://imgur.com/CxjSFyR.png alt="Turn off"></p></li></ol><h2 id=how-to-verify-that-the-actions-are-not-running-on-github-cloud>How to verify that the Actions are NOT running on Github Cloud</h2><ul><li><p>If the <code>yaml</code> file in <code>.github/workflows</code> folder contains <code>runs-on: self-hosted</code>, the action will never run on Github Cloud</p></li><li><p>You can also check the logs through the below steps:</p><ol><li><p>Go to the <code>Actions</code> Tab on Github Repository&rsquo;s link by visiting <code>https://github.com/USERNAME/REPONAME/actions</code></p></li><li><p>Click on the <code>Workflow</code> that you want to check</p><p><img src=https://imgur.com/L7kSxSa.png alt="Click on Workflow"></p></li><li><p>Click on the tag containing the job name</p><p><img src=https://imgur.com/NhELaP3.png alt="Click on Job name"></p></li><li><p>Click on the <code>Set up job</code> header, to read the logs. You will find that the <code>Machine name</code> or <code>Runner name</code> have contain <code>cirun</code>, which indicates that the job ran on a machine on another cloud created by Cirun.</p><p><img src=https://imgur.com/erMar71.png alt="Machine name or Runner name"></p></li></ol></li></ul><p>(The Actions that run on Github Cloud have different logs. They look something like this</p><p><img src=https://imgur.com/BROBmHq.png alt="Actions that run on Github Cloud">)</p><h1 id=thanks>Thanks</h1><p>Thanks to <a href=https://twitter.com/iaktech>Amit Kumar</a>, the founder of Cirun.io, who help us setup Cirun at <a href=http://neera.ai/>Neera.ai</a>. At Neera, we run a cronjob every 10 minutes to update User&rsquo;s pocket articles and Notion documents. Github Actions provides a convenient interface to check the status of Cronjob. With 2 cronjob running every 10 minutes, we were out of free minutes soon after a couple of weeks. Now currently, we run both the cronjobs on Digital Ocean cloud using Cirun.</p><p>Setting up Cirun was really a smooth experience and done quickly. There are other nice use cases for Cirun like it supports running on GPU, which Github actions does not. Most amazing thing about Cirun is, it is free for open source Projects.</p><p><img src=https://imgur.com/qtcL3u2.png alt="Cirun Supporting Open Source"></p><h2 id=appendix>Appendix</h2><ul><li>Repository Link used for Demo - <a href=https://github.com/rakaar/cirun-demo>https://github.com/rakaar/cirun-demo</a></li><li>Video to setup Cirun on AWS Cloud - <a href=https://youtu.be/lDx0YVTn6yg>https://youtu.be/lDx0YVTn6yg</a> (Demo video by Amit Kumar)</li></ul></section><div class=post-tags></div></article></main><footer><hr><a class=soc href=https://rakaar.github.io/index.xml title=RSS><i data-feather=rss></i></a>|<a class=soc href=mailto:rka87338@gmail.com title=Email><i data-feather=mail></i></a>|<a class=soc href=https://github.com/rakaar title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/raghavendrakau9 title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>