<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Understanding Hyperledger fabric byfn setup briefly - Raghavendra Kaushik</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction When I first go started with Hyperledger Fabric, it was a very daunting experience. All those yaml files, docker containers, commands, shell scripts confused a lot. Here in this article, I try to put those things very shortly on how a network is setup, mainly will consider the example of BYFN Hyperledger Fabric.
I am a beginner in the field. My sincere apologies to you, in case there are any errors or I failed to explain properly."><meta property="og:image" content><meta property="og:title" content="Understanding Hyperledger fabric byfn setup briefly"><meta property="og:description" content="Introduction When I first go started with Hyperledger Fabric, it was a very daunting experience. All those yaml files, docker containers, commands, shell scripts confused a lot. Here in this article, I try to put those things very shortly on how a network is setup, mainly will consider the example of BYFN Hyperledger Fabric.
I am a beginner in the field. My sincere apologies to you, in case there are any errors or I failed to explain properly."><meta property="og:type" content="article"><meta property="og:url" content="https://rakaar.github.io/posts/2020-04-04-hyperledger-fabric-understanding-byfn/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-04T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Understanding Hyperledger fabric byfn setup briefly"><meta name=twitter:description content="Introduction When I first go started with Hyperledger Fabric, it was a very daunting experience. All those yaml files, docker containers, commands, shell scripts confused a lot. Here in this article, I try to put those things very shortly on how a network is setup, mainly will consider the example of BYFN Hyperledger Fabric.
I am a beginner in the field. My sincere apologies to you, in case there are any errors or I failed to explain properly."><script src=https://rakaar.github.iojs/feather.min.js></script><link href=https://rakaar.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://rakaar.github.io/css/main.5a5ffad9e55591a3e4fcebdb9ed3807c781cabfdb4de3dcf89a187a9f18d9bd9.css></head><body><div class=content><header><div class=main><a href=https://rakaar.github.io>Raghavendra Kaushik</a></div><nav><a href=/>Home</a>
<a href=/posts>Blog</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Understanding Hyperledger fabric byfn setup briefly</h1><div class=meta>Posted on Apr 4, 2020</div></div><section class=body><h3 id=introduction>Introduction</h3><p>When I first go started with Hyperledger Fabric, it was a very daunting experience. All those yaml files, docker containers, commands,
shell scripts confused a lot. Here in this article, I try to put those things very shortly on how a network is setup, mainly will consider
the example of <a href=https://github.com/hyperledger/fabric-samples/tree/master/first-network>BYFN Hyperledger Fabric</a>.</p><p><em>I am a beginner in the field. My sincere apologies to you, in case there are any errors or I failed to explain properly. I am writting so as to get some more experience and clarity over this topic</em></p><h3 id=byfn---build-your-first-network-example>BYFN - Build your First Network example</h3><ul><li><p><strong>YAML Files</strong>:It all starts with <code>yaml</code> files. In case you are wondering what this is, YAML is a language used in most of the configuration files
for many of the applications. Here, we mainly deal with three yaml files</p><ul><li><strong>crypto-config.yaml</strong>: Here we define the organizations,number of peers under each organization and the ordering service,which is used for ordering the transactions</li><li><strong>configtx.yaml</strong>: Here we include an entry for MSP(Membership Service Providers) for each organization. In addition, we shall also include the names of organizations in the constortium(Collection of non ordering organizations that join the network). Also in the profiles section, along with consortium config you will find channel and orderer configs included.</li><li><strong>docker-compose-cli.yaml</strong>: Required for booting up the entire network. Here we define the containers we requrie - one container for one peer. There is another important container - <em>cli</em> container defined here, which provides us command line utlity to start the network, create channels, join orgs to the channel.</li></ul></li><li><p><strong>Utilities in action</strong>: Once the configuration is done the utilities use these config files to perform certain tasks like generating certificates, starting a genesis block, creating a channel, joining organizations to the channel.</p><ul><li><strong>Cyrptogen</strong>: Crytogen is used in generating Hyperledger Fabric key material. It means it will be used to generate the certificates for the orderers and peers defined in the configuration files.
Generally the file <code>byfn.sh</code> automates most of the commands in setting up your first network. However it is when we look into the file, you understand the process of a network setup
In <code>byfn.sh</code> file, you can find the command</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cryptogen generate --config=./crypto-config.yaml
</code></pre></td></tr></table></div></div><p>cryptogen uses <code>crypto-config.yaml</code> to generate the certificates. You will find a new directories created with two sub directories - <em>peerOrganizations</em> and <em>ordererOrganizations</em>
The ordererOrganizations directory contains a diretories of each of its orderers. While peerOrganizations contain directories for each of peers. The directory for each peer or orderer includes different directories - <code>ca</code>,<code>msp, </code>tlsca<code>, </code>users`, which contain the necessary key material</p><ul><li><strong>Configtxgen</strong>: The configtxgen command allows users to create and inspect channel config related artifacts. The content of the generated artifacts is dictated by the contents of <code>configtx.yaml</code>(definition in docs, self explainatory)<ul><li><em>Creating a genesis block</em>: The genesis block is the first block in the blockchain. In Fabric, the genesis block contains information about the channel.</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>  configtxgen -profile SampleMultiNodeEtcdRaft -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block
</code></pre></td></tr></table></div></div><pre><code>The above commands creates a genesis block in the `channel-artifacts` folder. `SampleMutliNodeEtcDraft` indicates to generate genesis block for a raft ordering service. `byn-sys-channel`  indicates the name of the channel which is used to indicate by the flag `-channelID`
</code></pre><ul><li><em>Creating a channel configuration Transaction</em>: The channel configuration file <code>channel.tx</code> contains a definitions for our sample channel</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mysamplechannel
</code></pre></td></tr></table></div></div><p>(I am deliberately skipping the anchor peers part, as a network can be setup without anchor peers too)</p></li></ul></li><li><p><strong>Furthur Steps</strong></p><ul><li><em>Starting the Network</em>: <code>docker-compose</code>(A tool to run multi container Docker applications) shall be used here to start the containers</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>docker-compose -f docker-compose-cli.yaml -f docker-compose-etcdraft2.yaml up
</code></pre></td></tr></table></div></div><p>You can check that the containers are running by using the command</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>docker ps -a
</code></pre></td></tr></table></div></div><ul><li><em>Creating the channel</em>: To create a channel we must be able to enter the cli command tool, we do that by running the command</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>docker exec -it cli bash
</code></pre></td></tr></table></div></div><ul><li><em>Creating a channel</em> : Now to create a channel, we pass the channel configuration transaction, channel name, ca-certs to the orderer</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>peer channel create -o orderer.example.com:7050 -c mysamplechannel -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre></td></tr></table></div></div><ul><li><em>Join Peers to channel</em>:
Set the following as environment variables. This is required so as to join peers to the channel</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_LOCALMSPID=&#34;Org1MSP&#34;
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
</code></pre></td></tr></table></div></div><p>Use the following command to add peer0 to the channel</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>peer channel join -b mychannel.block
</code></pre></td></tr></table></div></div><p>Similarly you need to set environment variables for other peers so as to add them,Instead you can write a script like <a href=https://gist.githubusercontent.com/ialberquilla/4fd5a94fba3a73e7893b43f3eebca709/raw/a6dc73759b87b544cb1bb850555f8c4f2748faeb/join-peer.sh>this</a>
to add peers to the channel</p></li></ul><p><em>We are done with setting up a network - a channel with peers joined :)</em></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/hyperledger>hyperledger</a></li><li><a href=/tags/blockchain>blockchain</a></li><li><a href=/tags/distributed-systems>distributed systems</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://rakaar.github.io/index.xml title=RSS><i data-feather=rss></i></a>|<a class=soc href=mailto:rka87338@gmail.com title=Email><i data-feather=mail></i></a>|<a class=soc href=https://github.com/rakaar title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/raghavendrakau9 title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>