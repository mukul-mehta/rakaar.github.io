<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Ignoring extra words in MeiliSearch v0.20 - Raghavendra Kaushik</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MeiliSearch is a search API, which is super easy to setup and has some amazing features like being typo tolerant, handling synonyms, highlighting, multi language support and more. Setting up MeiliSearch and working with it as a developer has been a smooth experience. The documentation is also well written.
But there is one problem! MeiliSearch fails to return when there is an extra useless word. For example, here is a Crates browser demo of MeiliSearch which searches through Rust crates."><meta property="og:image" content><meta property="og:title" content="Ignoring extra words in MeiliSearch v0.20"><meta property="og:description" content="MeiliSearch is a search API, which is super easy to setup and has some amazing features like being typo tolerant, handling synonyms, highlighting, multi language support and more. Setting up MeiliSearch and working with it as a developer has been a smooth experience. The documentation is also well written.
But there is one problem! MeiliSearch fails to return when there is an extra useless word. For example, here is a Crates browser demo of MeiliSearch which searches through Rust crates."><meta property="og:type" content="article"><meta property="og:url" content="https://rakaar.github.io/posts/2021-06-21-meilisearchfail/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ignoring extra words in MeiliSearch v0.20"><meta name=twitter:description content="MeiliSearch is a search API, which is super easy to setup and has some amazing features like being typo tolerant, handling synonyms, highlighting, multi language support and more. Setting up MeiliSearch and working with it as a developer has been a smooth experience. The documentation is also well written.
But there is one problem! MeiliSearch fails to return when there is an extra useless word. For example, here is a Crates browser demo of MeiliSearch which searches through Rust crates."><script src=https://rakaar.github.io/js/feather.min.js></script><link href=https://rakaar.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://rakaar.github.io/css/main.5a5ffad9e55591a3e4fcebdb9ed3807c781cabfdb4de3dcf89a187a9f18d9bd9.css></head><body><div class=content><header><div class=main><a href=https://rakaar.github.io/>Raghavendra Kaushik</a></div><nav><a href=/>Home</a>
<a href=/posts>Blog</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
<a href=/credits>Credits</a></nav></header><main><article><div class=title><h1 class=title>Ignoring extra words in MeiliSearch v0.20</h1><div class=meta>Posted on Jun 21, 2021</div></div><section class=body><p>MeiliSearch is a search API, which is super easy to setup and has some amazing features like being typo tolerant, handling synonyms, highlighting, multi language support and more. Setting up MeiliSearch and working with it as a developer has been a smooth experience. The documentation is also well written.</p><p>But there is one problem! MeiliSearch fails to return when there is an extra useless word. For example, <a href=https://crates.meilisearch.com/>here</a> is a Crates browser demo of MeiliSearch which searches through Rust crates. The demo is built by the MeiliSearch team and they also have a <a href=https://blog.meilisearch.com/search-rust-crates-meili/>blog</a> post on it.</p><p>So when you search something like &ldquo;crypto&rdquo; in the Crates browser, it returns results within 5 milliseconds.</p><p><img src=https://imgur.com/54M0s74.png alt="https://crates.meilisearch.com/?q=crypto"></p><p>But when I add an extra random word like my name to the search query, no results are returned.</p><p><img src=https://imgur.com/mMWZB5K.png alt="https://crates.meilisearch.com/?q=crypto+raghav"></p><h1 id=fixing-it>Fixing it</h1><p>At <a href=http://neera.ai/>Neera</a>, we faced same issue was faced while integrating Pocket search. This is what we did to fix it. If MeiliSearch doesn&rsquo;t return any result, we trim the query and resend the search query to MeiliSearch and we continue this until a response is found. The query is trimmed from both the sides. First query is trimmed word by word from Right hand side till a result is obtained. If that fails, the query is trimmed word by word from Left hand side till MeiliSearch returns a response.</p><p>The following is the code in JS</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>MeiliSearch</span>({<span style=color:#e6db74>&#34;host&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;http://localhost:7700&#34;</span>})
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A QUERY FROM THE USER CONTAINING USELESS WORDS&#34;</span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>INDEX</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;INDEX_FOR_DOCUMENTS&#34;</span>

<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>search_response</span>;
<span style=color:#a6e22e>search_response</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>index</span>(<span style=color:#a6e22e>INDEX</span>).<span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>query</span>);

<span style=color:#75715e>// if MeiliSearch returns no results, i.e search_response.hits is an empty array, words are trimmed
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>search_words_for_right_trim</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>search</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>search_words_for_left_trim</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>search</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>);

<span style=color:#75715e>// Till there is atleast one result, keep trimming words from the query
</span><span style=color:#75715e></span><span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>search_response</span>.<span style=color:#a6e22e>hits</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>search_words_for_left_trim</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>search_words_for_right_trim</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>)) {

    <span style=color:#75715e>// initially words are trimmed from the right hand side
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>search_words_for_right_trim</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {
          <span style=color:#a6e22e>search_words_for_right_trim</span>.<span style=color:#a6e22e>pop</span>()
          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>new_query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>search_words_for_right_trim</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39; &#39;</span>)
          <span style=color:#a6e22e>search_response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>index</span>(<span style=color:#a6e22e>INDEX</span>).<span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>new_query</span>);
        }
    <span style=color:#75715e>// if trimming from right has not fetched any results, words are trimmed from the left hand side
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> {
          <span style=color:#a6e22e>search_words_for_left_trim</span>.<span style=color:#a6e22e>shift</span>()
          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>new_query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>search_words_for_left_trim</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39; &#39;</span>)
          <span style=color:#a6e22e>search_response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>index</span>(<span style=color:#a6e22e>INDEX</span>).<span style=color:#a6e22e>search</span>(<span style=color:#a6e22e>new_query</span>);
        }
      }
</code></pre></td></tr></table></div></div><p>Why not trim character by character? So, if you trim character by character, many queries get wasted. MeiliSearch tolerates if there are 3 or 4 extra characters but fails, with just a single word. Hence, trimming word by word was prefered in this case.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/programming>programming</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://rakaar.github.io/index.xml title=RSS><i data-feather=rss></i></a>|<a class=soc href=mailto:rka87338@gmail.com title=Email><i data-feather=mail></i></a>|<a class=soc href=https://github.com/rakaar title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/raghavendrakau9 title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>